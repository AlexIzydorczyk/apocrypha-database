<div id="modern-source-form">
<%= form_with(model: modern_source, class: "autosave") do |form| %>
<div class="row">
	<div class="form-group col-md-12 mb-2">
		<%= form.label :source_type, "Type of bibliographic item", style: "display: block" %>
		<%= form.select :source_type, options_for_select(%w(authored_book edited_book book_chapter journal_article unpublished_document web_page handwritten_document).map{ |i| [ i.humanize, i ]}, modern_source.source_type), {include_blank: true}, {class: "form-control", placeholder: "Select a type…", "v-model": "source_type"} %>
	</div>

	<div class="form-group mb-2" :class="source_type == 'journal_article' || source_type == 'book_chapter' ? 'col-md-6' : 'col-md-5'" v-show="source_type == 'journal_article' || source_type == 'book_chapter'">
		<label>{{ source_type == 'journal_article' ? "Title of article in original language" : "Book title in original language" }}</label>
		<language-form-groups
			key="modern-souce-chapter-title"
			record_type="modern_source"
			name="Title"
			language_column="title_language_id"
			orig="title_orig"
			translit="title_transliteration"
			eng="title_translation"
		></language-form-groups>
	</div>

	<div class="form-group mb-2" :class="source_type == 'journal_article' || source_type == 'book_chapter' ? 'col-md-6' : 'col-md-5'">
		<label>{{ source_type == 'journal_article' ? "Journal title in original language" : "Chapter title original language" }}</label>
		<language-form-groups
			key="modern-souce-publication-title"
			record_type="modern_source"
			name="Title"
			language_column="publication_title_language_id"
			orig="publication_title_orig"
			translit="publication_title_transliteration"
			eng="publication_title_translation"
		></language-form-groups>
	</div>

	<div :class="source_type == 'book_chapter' || source_type == 'journal_article' ? 'col-md-12' : 'col-md-6'" v-show="source_type == 'authored_book' || source_type == 'book_chapter' || source_type == 'journal_article'">
		<div class="row">
			<%= fields_for(@author_reference) do |ar| %>
				<div class="form-group col-md-6 mb-2" v-show="author_type == 'regular'">
					<%= ar.label :id, "Author(s)", style: "display: block" %>
					<div class="d-flex">
						<%= ar.collection_select :id, Person.all, :id, :full_name, {selected: modern_source.people.map(&:id)}, {class: "form-control", multiple: true} %>
						<button type="button" class="btn btn-outline-action ms-4" data-bs-toggle="modal" data-bs-target="" disabled>New</button>
					</div>
				</div>
			<% end %>
			<div class="form-group col-md-6 mb-2" v-show="author_type == 'corporate'">
				<%= form.label :institution_id, "Author(s)", style: "display: block" %>
				<div class="d-flex">
					<%= form.collection_select :institution_id, Institution.all, :id, :display_name, {include_blank: true}, {class: "form-control", placeholder: "Select an institution…"} %>
					<button type="button" class="btn btn-outline-action ms-4" data-bs-toggle="modal" data-bs-target="" disabled>New</button>
				</div>
			</div>
			<div class="form-group col-md-6 mb-2" v-if="author_type != 'corporate' && author_type != 'regular'">
			</div>
			<div class="form-group col-md-6 mb-2 align-items-center">
				<%= form.label :author_type, style: "display: block" %>
				<%= form.hidden_field :author_type, "v-model": "author_type" %>
				<span @click="author_type = 'regular'" class="pointer">
					<i class="far" style="color: var(--orange)" :class="author_type == 'regular' ? 'fa-dot-circle' : 'fa-circle'"></i>
					<label>Regular author</label>
				</span>
				<span @click="author_type = 'corporate'" class="pointer ms-3">
					<i class="far" style="color: var(--orange)" :class="author_type == 'corporate' ? 'fa-dot-circle' : 'fa-circle'"></i>
					<label>Corporate author</label>
				</span>
			</div>
		</div>
	</div>

	<div class="col-md-6" v-show="!(source_type == 'authored_book' || source_type == 'book_chapter' || source_type == 'journal_article')"></div>

	<div class="form-group col-2 mb-2">
		<%= form.label :edition, style: "display: block" %>
		<%= form.text_field :edition, class: "form-control" %>
	</div>
	<%= fields_for :editor_reference, @editor_reference do |er| %>
		<div class="form-group col-md-5 mb-2">
			<%= er.label :id, "Editor(s)", style: "display: block" %>
			<div class="d-flex">
				<%= er.collection_select :id, Person.all, :id, :full_name, {selected: modern_source.editors.map(&:id)}, {class: "form-control", multiple: true} %>
				<button type="button" class="btn btn-outline-action ms-4" data-bs-toggle="modal" data-bs-target="" disabled>New</button>
			</div>
		</div>
	<% end %>
	<%= fields_for :translator_reference, @translator_reference do |tr| %>
		<div class="form-group col-md-5 mb-2">
			<%= tr.label :id, "Translator(s)", style: "display: block" %>
			<div class="d-flex">
				<%= tr.collection_select :id, Person.all, :id, :full_name, {selected: modern_source.translators.map(&:id)}, {class: "form-control", multiple: true} %>
				<button type="button" class="btn btn-outline-action ms-4" data-bs-toggle="modal" data-bs-target="" disabled>New</button>
			</div>
		</div>
	<% end %>

	<h2>Section</h2>
	
	<div class="form-group col-md-2 mb-2" v-show="source_type != 'journal_article'">
		<%= form.label :num_volumes, "No. of volumes", style: "display: block" %>
		<%= form.text_field :num_volumes, class: "form-control" %>
	</div>
	<div class="form-group col-md-2 mb-2">
		<label style="display: block;">{{ source_type == 'journal_article' ? "Issue no." : "Volume no." }}</label>
		<%= form.text_field :volume_no, class: "form-control" %>
	</div>
	<div class="form-group col-md-8 mb-2" v-show="source_type != 'journal_article'">
		<label>Volume title in original language</label>
		<language-form-groups
			key="modern-souce-volume-title"
			record_type="modern_source"
			name="Title"
			language_column="volume_title_language_id"
			orig="volume_title_orig"
			translit="volume_title_transliteration"
			eng="volume_title_translation"
		></language-form-groups>
	</div>

	<div class="form-group col-2 mb-2" v-show="source_type != 'journal_article'">
		<%= form.label :part_no, "Part no.", style: "display: block" %>
		<%= form.text_field :part_no, class: "form-control" %>
	</div>
	<div class="form-group col-md-10  mb-2" v-show="source_type != 'journal_article'">
		<label>Part title in original language</label>
		<language-form-groups
			key="modern-souce-part-title"
			record_type="modern_source"
			name="Title"
			language_column="part_title_language"
			orig="part_title_orig"
			translit="part_title_transliteration"
			eng="part_title_translation"
		></language-form-groups>
	</div>

	<div class="form-group col-2 mb-2">
		<label style="display: block;">{{ source_type == 'journal_article' ? "Journal series" : "Series no." }}</label>
		<%= form.text_field :series_no, class: "form-control" %>
	</div>
	<div class="form-group col-md-10  mb-2" v-show="source_type != 'journal_article'">
		<label>Series title in original language</label>
		<language-form-groups
			key="modern-souce-series-title"
			record_type="modern_source"
			name="Title"
			language_column="series_title_language_id"
			orig="series_title_orig"
			translit="series_title_transliteration"
			eng="series_title_translation"
		></language-form-groups>
	</div>

	<h2>Publication</h2>

	<div class="col-md-12">
		<div class="row">
			<div class="form-group col-md mb-2">
				<%= form.label :publication_creation_date, style: "display: block" %>
				<%= form.text_field :publication_creation_date, class: "form-control" %>
			</div>
			<div class="form-group col-md mb-2" v-show="source_type != 'journal_article'">
				<%= form.label :publisher, style: "display: block" %>
				<%= form.text_field :publisher, class: "form-control" %>
			</div>
			<div class="form-group col-md mb-2" v-if="source_type == 'book_chapter' || source_type == 'journal_article'">
				<%= form.label :pages_in_publication, style: "display: block" %>
				<%= form.text_field :pages_in_publication, class: "form-control" %>
			</div>
			<div class="form-group col-md mb-2" v-show="source_type != 'journal_article'">
				<%= form.label :publication_location_id, style: "display: block" %>
				<%= form.collection_select :publication_location_id, Location.all, :id, :city_region_country, {selected: modern_source.publication_location_id, include_blank: true}, {class: "form-control"} %>
			</div>
		</div>
	</div>

	<div class="form-group col-3 mb-2">
		<%= form.label :DOI, "DOI", style: "display: block" %>
		<%= form.text_field :DOI, class: "form-control" %>
	</div>
	<div class="form-group col-md-9 mb-2">
		<label style="display: block;">URLs</label>
		<div id="urls">
			<div v-for="(url, index) in urls" class="d-flex mb-2">
				<input type="text" name="modern_source[urls][]" class="form-control" :value="url">	
				<button type="button" v-show="index == urls.length-1" class="btn btn-outline-action ms-4" @click="urls.push('')">New</button>
			</div>
		</div>
	</div>


	<!--
	<div class="form-group col-4 mb-2">
		<%= form.label :shelfmark, style: "display: block" %>
		<%= form.text_field :shelfmark, class: "form-control" %>
	</div>
	 -->
</div>
<div>
	<%= form.submit "Submit", class: "btn btn-primary mt-2" %>
</div>
<% end %>
</div>

<script type="text/javascript">
	<%= render "modern_sources/scripts", modern_source: modern_source %>
	<%= render "layouts/language_form_group" %>
</script>
